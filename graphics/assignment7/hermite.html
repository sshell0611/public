
<h2>Assignment 7</h2>
<p><hr>&nbsp;<p>

<table>
<tr>
<td><canvas id=canvas1 width=300 height=300></td>
<td width=50></td>
<td valign=top>
<br>
</td>
</tr>


<script src=drawlib1.js></script>
<script>

	var id     = 'canvas1';
   	var canvas = initCanvas(id);

	canvas.addEventListener('mousedown', DragStart);
	canvas.addEventListener('mousemove', Dragging);
	canvas.addEventListener('mouseup', DragEnd);

	var origin = new Vector3(0,0,0);
	var points = []; 
	var isDragging = false;

    canvas.update = function(g) {

			this.g = g;

			g.lineCap  = "round";
			g.lineJoin = "round";

			g.fillStyle = 'rgb(220,250,255)';

			g.beginPath();
			g.moveTo(0,0);
			g.lineTo(this.width, 0);
			g.lineTo(this.width, this.height);
			g.lineTo(0, this.height);
			g.fill();


			var p0 = new Vector3(-.35, .25, 0);
			var p1 = new Vector3(0, .45, 0.25);
			var p2 = new Vector3(.35, -.25, 1);

			points[0] = p0;
			points[1] = p1; 
			points[2] = p2;
			var n = 30;

			drawCubicSpline(id, points, n, true);

			/*var xvec = new Vector4(p0.x, p1.x, p0.z, p1.z);
			var yvec = new Vector4(p0.y, p1.y, p0.z, p1.z);
			var H = hermiteMatrix();

			//testing hermite interpolation
			var ptArr = [];
			for (i = 1; i <= n; ++i)
			{
				t = i/n;
				var x_abcd = H.multiplyV4(xvec);
				var y_abcd = H.multiplyV4(yvec);
				var xval = hermitePoly(x_abcd.x, x_abcd.y, x_abcd.z, x_abcd.w, t);
				var yval = hermitePoly(y_abcd.x, y_abcd.y, y_abcd.z, y_abcd.w, t);
				var pt = new Vector3(xval, yval, 1);
				ptArr[i-1] = pt;

			}

			drawLines(id, ptArr);*/

			g.lineWidth = 7.5;
			drawPoints(id, points);
 	}

	////////////////////////////////////////////////////////////////
	// Helper functions for dragging the curve
	////////////////////////////////////////////////////////////////

	function DragStart(e) {
		//var loc = windowToCanvas(canvas, e.clientX, e.clientY);
		var loc = viewToPoint(canvas, e.clientX, e.clientY);
		//console.log('DragStart'); 
		console.log(loc.x);
		console.log(loc.y);
		//if (button == 3) { e.preventDefault(); }
		var button = e.which;

		for (i = 0; i < points.length; i++) 
		{
			console.log(points[i].x);
			console.log(points[i].y);
			if (HitTest(points[i], loc.x, loc.y)) 
			{
				console.log('hit a point, starting to drag');
				isDragging = true;	
			}
		}

	};

	function Dragging(e) {
		//console.log('Dragging'); 
	};

	function DragEnd(e) {
		console.log('DragEnd'); 
	};

	function HitTest(testPt, mouseX, mouseY) {

		var dx = mouseX - testPt.x;
		var dy = mouseY - testPt.y;

		var rad = 0.01;	

		var dist = dx*dx + dy*dy;

		console.log('distance');
		console.log(dist);

		return (dist < rad*rad);
	};


</script>

