
<h2>Assignment 7</h2>
<p><hr>&nbsp;<p>

<table>
<tr>
<td><canvas id=canvas1 width=500 height=500></td>
<td width=50></td>
<td valign=top>
<br>
<b>Curve Editor</b>
<br><br>
Using the Hermite spline technique.
<br>
<ul>
		<li>Click anywhere in the canvas to add a point.</li>
		<li>Right-click on a point to remove the point.</li>
		<li>Drag a point anywhere on canvas to adjust the curve.</li>
		<li>Match derivatives between splines:
<form action="hermite.html">
<input type="radio" name="deriv" value="1" checked>Yes
<br>
<input type="radio" name="deriv" value="0">No
</form> 
</ul>
</form>
</td>
</tr>


<script src=drawlib1.js></script>
<script>

	var id     = 'canvas1';
   	var canvas = initCanvas(id);

	canvas.addEventListener('mousedown', DragStart);
	canvas.addEventListener('mousemove', Dragging);
	canvas.addEventListener('mouseup', DragEnd);

	var origin = new Vector3(0,0,0);
	var points = []; 
	var isDragging = false;
	var dragPtIdx = -1;
	var steps = 50;

	//var p0 = new Vector3(-.35, .25, 0);
	//var p1 = new Vector3(0, .45, 0.25);
	//var p2 = new Vector3(.35, -.25, 1);
	points[0] = new Vector3(-.35, .25, 0);
	points[1] = new Vector3(0, .45, 0.25); 
	points[2] = new Vector3(.35, -.25, 1);;

    canvas.update = function(g) {

			this.g = g;
			var deriv = document.getElementsByName('deriv');
			var match = deriv[0].checked;

			g.lineCap  = "round";
			g.lineJoin = "round";

			g.fillStyle = 'white';//'rgb(220,250,255)';

			g.beginPath();
			g.moveTo(0,0);
			g.lineTo(this.width, 0);
			g.lineTo(this.width, this.height);
			g.lineTo(0, this.height);
			g.fill();

			//drawCubicSpline(id, points, steps, true);

			//g.fillStyle = 'blue';
			g.strokeStyle = 'blue';
			if (points.length > 1)
			{
				drawCubicSpline(id, points, steps, match);
			}

			g.lineWidth = 7.5;
			g.strokeStyle = 'black';
			drawPoints(id, points, dragPtIdx);

			drawBorder(g, 'black', this.width, this.height);

 	}

	////////////////////////////////////////////////////////////////
	// Helper functions for dragging the curve
	////////////////////////////////////////////////////////////////

	function AddNewPoint(ptLoc) {
		var idx = points.length;
		points[idx] = new Vector3(ptLoc.x, ptLoc.y, 1);
	}

	function RemovePoint(index) {
		if (index >=0 && index < points.length)
		{
			points.splice(index, 1); 
		}
	}

	function DragStart(e) {
		var loc = viewToPoint(canvas, e.clientX, e.clientY);
		var button = e.which;
		for (i = 0; i < points.length; i++) 
		{
			if (HitTest(points[i], loc.x, loc.y)) 
			{
				//if it is a right click, remove the point, else drag it
				if (button == 1) 
				{
					isDragging = true;	
					dragPtIdx  = i;
					return;
				}
				else if (button == 3)
				{
					RemovePoint(i);
					return;
				}
			}
		}

		if (!isDragging && button == 1) { AddNewPoint(loc); }

	};

	function Dragging(e) {

		if (isDragging && dragPtIdx !== -1)
		{
			var mouse = windowToCanvas(canvas, e.clientX, e.clientY);
			var loc   = viewToPoint(canvas, e.clientX, e.clientY);

			var pt = points[dragPtIdx];

			pt.x = loc.x;
			pt.y = loc.y;
		}
	};

	function DragEnd(e) {

		if (isDragging) 
		{
			isDragging = false;
			dragPtIdx = -1;	
		}
	};

	function HitTest(testPt, mouseX, mouseY) {

		var dx = mouseX - testPt.x;
		var dy = mouseY - testPt.y;

		var rad = 0.05;	

		var dist = dx*dx + dy*dy;

		return (dist < rad*rad);
	};


</script>

