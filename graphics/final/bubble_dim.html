<!DOCTYPE html>
<html>

<script src="js/three.js"></script>
<script src="js/renderers/Projector.js"></script>
<script src="js/renderers/CanvasRenderer.js"></script>
<script src="fonts/gentilis_bold.typeface.js"></script>
<script src="fonts/gentilis_regular.typeface.js"></script>
<script src="fonts/optimer_bold.typeface.js"></script>
<script src="fonts/optimer_regular.typeface.js"></script>
<script src="fonts/helvetiker_bold.typeface.js"></script>
<script src="fonts/helvetiker_regular.typeface.js"></script>
<script src="fonts/droid/droid_sans_regular.typeface.js"></script>
<script src="fonts/droid/droid_sans_bold.typeface.js"></script>
<script src="fonts/droid/droid_serif_regular.typeface.js"></script>
<script src="fonts/droid/droid_serif_bold.typeface.js"></script>
<script src="js/papaparse.js"></script>
<script src="js/jquery-1.11.3.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="HammerVis.js"></script>
<script src="js/jquery.dataTables.min.js"></script>

	<head>
		<title>Final Project</title>
			<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<!-- Bootstrap -->
		<link href="css/bootstrap.min.css" rel="stylesheet" media="screen">

		<style type="text/css">
		body {
		padding-top: 20px;
		padding-bottom: 40px;
		}

		/* Custom container */
		.container-narrow {
		margin: 0 auto;
		max-width: 700px;
		}
		.container-narrow > hr {
		margin: 30px 0;
		}

		/* Main marketing message and sign up button */
		.jumbotron {
		margin: 30px 0;
		text-align: center;
		}
		.jumbotron h1 {
		font-size: 72px;
		line-height: 1;
		}
		.jumbotron .btn {
		font-size: 21px;
		padding: 14px 24px;
		}

		/* Supporting marketing content */
		.marketing {
		margin: 60px 0;
		}
		.marketing p + h4 {
		margin-top: 28px;
		}
		</style>
		<link href="css/bootstrap-responsive.css" rel="stylesheet">

	</head>

<body>

<div class="container-narrow">

<div class="masthead">
<ul class="nav nav-pills pull-right">
<li class="active"><a href="index.html">Home</a></li>
</ul>
<h3 class="muted">Final Project: HammerVis</h3>
</div>

<hr>

<div class="jumbotron">
<h4>Bubble Chart</h4>
</div>
<p align="justify">
Bubble charts are typically used to display three dimensions of data: position on the x and y axis and the size of the bubble.  A fourth dimension can be communicated by using the color of the bubble.  Graphics present the opportunity to add additional dimensions into the chart.  
</p>
<p align="justify">
In this example, I use the texture of the bubble as a replacement for color.  The two different textures communicate whether each point is hot or cold.  For this data set, this indicates whether the stock traded more or less than it's average daily volume.  I also used rotation of the spheres to communicate another dimension of speed.  The faster the sphere is rotating indicates a higher speed.  For this data set, this communicates the realized volatility of the the stock over the past 6 days - essentially how much the stock price has moved recently.  The x-axis is displaying how much the stock has moved today.  Taken together with the recent "speed", we can see whether the stock is continuing with the recent trend or breaking from it.
</p>
<p align="justify">
I think that using graphics in bubble charts can be very effective at communicating additional dimesionality of data.  One can also imagine this same chart used intraday with real-time data.  The rotation speed could also show how much the stock has moved over the last X minutes intraday.  This is something that cold not be displayed with a static bubble chart.
</p>

<script>
		window.time = 0;
		window.count = 0;
		window.SimpleScene = function() {

				this.init = function(name) {
				this.scene = new THREE.Scene();
				//this.renderer = new THREE.CanvasRenderer( { alpha: true } );
				this.renderer = new THREE.WebGLRenderer( { alpha: true, antialias:true } );
				this.renderer.setSize(800, 800);
				this.renderer.setPixelRatio(window.devicePixelRatio);
				//this.renderer.setClearColor( 0xff0000 );
				//this.renderer.setSize(window.innerWidth, window.innerHeight);
				//this.renderer.shadowMapEnabled = true;
				var canvas = this.renderer.domElement;
				console.log(canvas);

				// CREATE THE CAMERA, AND ATTACH IT TO THE SCENE.

				this.camera = new THREE.PerspectiveCamera(50, 1, 0.1, 10000);
				//this.camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 2000);
				this.camera.position.z = 5;
				this.scene.add(this.camera);
				//this.camera.lookAt(this.scene.position)

				// CREATE THE WEBGL RENDERER, AND ATTACH IT TO THE DOCUMENT BODY.

				document.getElementById(name).appendChild(this.renderer.domElement);
				document.addEventListener('mousedown', onMouseDown, false);
				document.addEventListener('mousemove', onMouseMove, false);

				// CALL THE USER'S SETUP FUNCTION JUST ONCE.

				this.setup();

				// START THE ANIMATION LOOP.

				var that = this;
				(function tick() {
					time = (new Date().getTime()) / 1000;
					that.update();
					that.renderer.render(that.scene, that.camera);
					requestAnimationFrame(tick);
				})();

			}
		};
</script>


<table align="center">
<tr>
		<!--<td><b>Volatility<b><td>-->
	<td id=Scene1_code></td>
	<td id='Scene1_id'></td>
</tr>
</table>

<hr>

<script>
		Scene1.prototype = new SimpleScene;
		//var scene1 = new Scene1().init('Scene1_id');
		var scene1 = new Scene1();
		scene1.init('Scene1_id');

		var raycaster = new THREE.Raycaster();
		var mouse = new THREE.Vector2();


		function CreateHistory() {

			var pts = [
					new BubblePoint( 0.0 , 0.0 ,  0.3 ),
					new BubblePoint(-0.4 ,-0.2 ,  0.5 ),
					new BubblePoint(-0.7 ,-0.3 ,  1.2 ),
					new BubblePoint(-0.5 ,-1.1 ,  1.0 ),
					new BubblePoint(-0.8 ,-1.5 ,  1.75),
					new BubblePoint(-1.0 ,-2.0 ,  2.0 )
			];

			return pts;
		}

		function CreateBubbleSeries() {

			var series = new Series("Test", "bubble");

			var pts = [
					new BubblePoint( 1.0 , 2.0 ,  1.0 ),
					new BubblePoint( 0.0 ,-1.0 ,  1.5 ),
					new BubblePoint(-1.0 ,-2.0 ,  2.0 ),
					new BubblePoint(-0.5 , 2.0 ,  0.5 ),
					new BubblePoint(-0.25, 0.5 ,  0.25),
					new BubblePoint( 0.1 , 0.25,  0.5 )
			];

			pts[0].setDimensions([2.0, 30.0]);
			pts[1].setDimensions([1.5, 25.0]);
			pts[2].setDimensions([5.0, 10.0]);
			pts[3].setDimensions([1.0, 15.0]);
			pts[4].setDimensions([2.0, 10.0]);
			pts[5].setDimensions([3.0, 12.0]);

			//pts[2].setHistory(CreateHistory());

			series.addPoints(pts);
			return series;
		}


		function onMouseDown(event) {

			event.preventDefault();

			console.log(event);

			var w = scene1.renderer.domElement.width;
			var h = scene1.renderer.domElement.height;
			//var w = window.innerWidth;
			//var h = window.innerHeight;

			mouse.x = (event.offsetX / w) * 2 - 1;
			mouse.y = - (event.offsetY / h) * 2 + 1;

			console.log('x: ' + event.pageX + ', y: ' + event.pageY);
			console.log('x: ' + event.clientX + ', y: ' + event.clientY);
			console.log('x: ' + mouse.x + ', y: ' + mouse.y);
			console.log('w: ' + w + ', h: ' + h);

			raycaster.setFromCamera(mouse, scene1.camera);

			var objects = scene1.bubbleChart.getObjects();

			var num = 0;
			for (i=0; i<objects.length;++i) {
				console.log(objects[i].position);
				var intersects = raycaster.intersectObject(objects[i]);
				if (intersects.length > 0) {
					num++;
					//obj.object.material.color.setHex(0xff0000);
					scene1.bubbleChart.onObjectClicked(i);
				}
			}

			if (num == 0) {
				scene1.bubbleChart.onClick();
			}
		}

		function onMouseMove(event) {

		}



		function Scene1() {

				var ambLight, light;
				var center = new THREE.Vector2(0,0);
				var sz = new THREE.Vector2(4.5, 3.5);
				series = CreateBubbleSeries();

				//setup
				this.setup = function() {

					ambLight = new THREE.AmbientLight(0xffffff);
					light = new THREE.DirectionalLight(0xffffff);
					light.position.set(1,1,1).normalize();
					this.scene.add(light);

					this.bubbleChart = new Chart('bubble', center, sz, this.scene);
					this.bubbleChart.defineDimension(0, 'Texture');
					this.bubbleChart.defineDimension(1, 'Rotation');
					this.bubbleChart.yAxis.padding = 1.0;
					this.bubbleChart.xAxis.padding = 1.0;
					this.bubbleChart.addSeries(series);
					this.bubbleChart.render(this.scene);

				}

				//updates each frame
				this.update = function() {

					this.bubbleChart.update(this.scene, time);

				}
		}

</script>


<div class="jumbotron">
<h4>Data</h4>
</div>

<table cellpadding="0" cellspacing="0" border="0" class="cell-border" width="100%" id="example"></table>

</body>

</div> <!-- /container -->

</html>
